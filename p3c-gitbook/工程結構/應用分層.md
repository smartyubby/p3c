# 六、工程結構
## (一) 應用分層 

1. 【推薦】圖中預設上層依賴於下層，箭頭關係表示可直接依賴，如：開放介面層可以依賴於Web層，也可以直接依賴於Service層，依此類推：
 ![應用分層](../images/alibabaLevel.png)
 - 開放介面層：可直接封裝Service方法暴露成RPC介面；通過Web封裝成http介面；進行網關安全控制、流量控制等。 
 - 終端顯示層：各個端的模板渲染並執行顯示的層。當前主要是velocity渲染，JS渲染，JSP渲染，移動端展示等。 
 - Web層：主要是對訪問控制進行轉發，各類基本參數校驗，或者不復用的業務簡單處理等。 
 - Service層：相對具體的業務邏輯服務層。 
 - Manager層：通用業務處理層，它有如下特徵：
 <br>1） 對第三方平臺封裝的層，預處理返回結果及轉化異常訊息；
 <br>2） 對Service層通用能力的下沉，如緩存方案、中間件通用處理；
 <br>3） 與DAO層交互，對多個DAO的組合複用。
 - DAO層：資料訪問層，與底層MySQL、Oracle、Hbase等進行資料交互。 
 - 外部介面或第三方平臺：包括其它部門RPC開放介面，基礎平臺，其它公司的HTTP介面。

2. 【參考】（分層異常處理規約）在DAO層，產生的異常類型有很多，無法用細粒度的異常進行catch，使用catch(Exception e)方式，並throw new DAOException(e)，不需要輸出日誌，因爲日誌在Manager/Service層一定需要捕獲並輸出到日誌文件中去，如果同臺伺服器再打日誌，浪費性能和存儲。在Service層出現異常時，必須記錄出錯日誌到磁碟，儘可能帶上參數訊息，相當於保護案發現場。如果Manager層與Service同機部署，日誌方式與DAO層處理一致，如果是單獨部署，則採用與Service一致的處理方式。Web層絕不應該繼續往上拋異常，因爲已經處於頂層，如果意識到這個異常將導致頁面無法正常渲染，那麼就應該跳轉到友好錯誤頁面，加上用戶容易理解的錯誤提示訊息。開放介面層要將異常處理成錯誤碼和錯誤訊息方式返回。

3. 【參考】分層領域模型規約：
  - DO（Data Object）：與資料庫表結構一一對應，通過DAO層向上傳輸資料源物件。
  - DTO（Data Transfer Object）：資料傳輸物件，Service或Manager向外傳輸的物件。
  - BO（Business Object）：業務物件。由Service層輸出的封裝業務邏輯的物件。
  - AO（Application Object）：應用物件。在Web層與Service層之間抽象的複用物件模型，極爲貼近展示層，複用度不高。
  - VO（View Object）：顯示層物件，通常是Web向模板渲染引擎層傳輸的物件。
  - Query：資料查詢物件，各層接收上層的查詢請求。注意超過2個參數的查詢封裝，禁止使用Map類來傳輸。